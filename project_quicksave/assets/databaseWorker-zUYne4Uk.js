(function(){"use strict";const I="QuickSaveDB",x={name:"articles",options:{keyPath:"id"},indexes:[{name:"by_timestamp",keyPath:"timestamp",options:{unique:!1}}]};function _(e,t){if(t<1){const r=e.createObjectStore(x.name,x.options);for(const n of x.indexes)r.createIndex(n.name,n.keyPath,n.options)}}function E(){const e=indexedDB.open(I,2),t={passive:!0,once:!0};return new Promise((r,n)=>{const o=()=>{n(new Error(e.error?.message,{cause:e.error?.cause}))},c=()=>{const s=e.result,l=()=>{console.error("Database operation error:",e.error)},u=()=>{console.error("Database operation aborted:",e.error)},i=()=>{console.info("Database closed")},d=()=>{console.info("Database version changed")};s.addEventListener("error",l,t),s.addEventListener("abort",u,t),s.addEventListener("close",i,t),s.addEventListener("versionchange",d,t),r(s)},a=s=>{const l=e.result;_(l,s.oldVersion)};e.addEventListener("error",o,t),e.addEventListener("success",c,t),e.addEventListener("upgradeneeded",a,t)})}function b(e,t,r){const n=e.transaction(t,r),o={passive:!0,once:!0},c=()=>{console.error("Transaction error:",n.error)},a=()=>{console.error("Transaction aborted:",n.error)},s=()=>{console.info("Transaction completed")};return n.addEventListener("error",c,o),n.addEventListener("abort",a,o),n.addEventListener("complete",s,o),n}async function U(e){const t=await E(),r=b(t,e,"readonly"),o=r.objectStore(e).count(),c={passive:!0,once:!0},a=await new Promise((s,l)=>{const u=()=>{r.abort(),t.close(),l(new Error(o.error?.message,{cause:o.error?.cause}))},i=()=>{s(o.result)};o.addEventListener("error",u,c),o.addEventListener("success",i,c)});return r.commit(),t.close(),a}async function W(e,t){const r=await E(),n=b(r,e,"readwrite"),c=n.objectStore(e).add(t),a={passive:!0,once:!0},s=await new Promise((l,u)=>{const i=()=>{n.abort(),r.close(),u(new Error(c.error?.message,{cause:c.error?.cause}))},d=()=>{l(c.result)};c.addEventListener("error",i,a),c.addEventListener("success",d,a)});return n.commit(),r.close(),s}async function P(e,t){const r=await E(),n=b(r,e,"readonly"),c=n.objectStore(e).get(t),a={passive:!0,once:!0},s=await new Promise((l,u)=>{const i=()=>{u(new Error(c.error?.message,{cause:c.error?.cause}))},d=()=>{l(c.result)};c.addEventListener("error",i,a),c.addEventListener("success",d,a)});return n.commit(),r.close(),s===void 0?null:s}async function F(e,t){if(await P(e,t)===null)return!1;const n=await E(),o=b(n,e,"readwrite"),a=o.objectStore(e).delete(t),s={passive:!0,once:!0};return await new Promise((l,u)=>{const i=()=>{u(new Error(a.error?.message,{cause:a.error?.cause}))},d=()=>{l(a.result)};a.addEventListener("error",i,s),a.addEventListener("success",d,s)}),o.commit(),n.close(),!0}async function B(e,t=null,r,n,o=0){const c=await E(),a=b(c,e,"readonly"),s=a.objectStore(e),l=t?s.index(t):null,u=r==="ascending"?"next":"prev",i=l?l.openCursor(null,u):s.openCursor(null,u),d={passive:!0},f=await new Promise((m,ae)=>{const A=[];let q=0,H=o>0;const ce=()=>{a.abort(),c.close(),ae(new Error(i.error?.message,{cause:i.error?.cause}))},ie=()=>{const v=i.result;v&&q<n?H?(H=!1,v.advance(o)):(A.push(v.value),q+=1,v.continue()):m(A)};i.addEventListener("error",ce,d),i.addEventListener("success",ie,d)});return a.commit(),c.close(),f}async function G(e,t,r){const n=await P(e,t);if(n===null)return!1;for(const[u,i]of Object.entries(r))n[u]=i;const o=await E(),c=b(o,e,"readwrite"),s=c.objectStore(e).put(n),l={passive:!0,once:!0};return await new Promise((u,i)=>{const d=()=>{i(new Error(s.error?.message,{cause:s.error?.cause}))},f=()=>{u(s.result)};s.addEventListener("error",d,l),s.addEventListener("success",f,l)}),c.commit(),o.close(),!0}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const j=Symbol("Comlink.proxy"),N=Symbol("Comlink.endpoint"),Y=Symbol("Comlink.releaseProxy"),k=Symbol("Comlink.finalizer"),w=Symbol("Comlink.thrown"),O=e=>typeof e=="object"&&e!==null||typeof e=="function",Q={canHandle:e=>O(e)&&e[j],serialize(e){const{port1:t,port2:r}=new MessageChannel;return C(e,t),[r,[r]]},deserialize(e){return e.start(),K(e)}},X={canHandle:e=>O(e)&&w in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},M=new Map([["proxy",Q],["throw",X]]);function $(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function C(e,t=globalThis,r=["*"]){t.addEventListener("message",function n(o){if(!o||!o.data)return;if(!$(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:c,type:a,path:s}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(g);let u;try{const i=s.slice(0,-1).reduce((f,m)=>f[m],e),d=s.reduce((f,m)=>f[m],e);switch(a){case"GET":u=d;break;case"SET":i[s.slice(-1)[0]]=g(o.data.value),u=!0;break;case"APPLY":u=d.apply(i,l);break;case"CONSTRUCT":{const f=new d(...l);u=ne(f)}break;case"ENDPOINT":{const{port1:f,port2:m}=new MessageChannel;C(e,m),u=re(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(i){u={value:i,[w]:0}}Promise.resolve(u).catch(i=>({value:i,[w]:0})).then(i=>{const[d,f]=L(i);t.postMessage(Object.assign(Object.assign({},d),{id:c}),f),a==="RELEASE"&&(t.removeEventListener("message",n),R(t),k in e&&typeof e[k]=="function"&&e[k]())}).catch(i=>{const[d,f]=L({value:new TypeError("Unserializable return value"),[w]:0});t.postMessage(Object.assign(Object.assign({},d),{id:c}),f)})}),t.start&&t.start()}function J(e){return e.constructor.name==="MessagePort"}function R(e){J(e)&&e.close()}function K(e,t){return T(e,[],t)}function y(e){if(e)throw new Error("Proxy has been released and is not useable")}function z(e){return p(e,{type:"RELEASE"}).then(()=>{R(e)})}const h=new WeakMap,S="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(h.get(e)||0)-1;h.set(e,t),t===0&&z(e)});function Z(e,t){const r=(h.get(t)||0)+1;h.set(t,r),S&&S.register(e,t,e)}function ee(e){S&&S.unregister(e)}function T(e,t=[],r=function(){}){let n=!1;const o=new Proxy(r,{get(c,a){if(y(n),a===Y)return()=>{ee(o),z(e),n=!0};if(a==="then"){if(t.length===0)return{then:()=>o};const s=p(e,{type:"GET",path:t.map(l=>l.toString())}).then(g);return s.then.bind(s)}return T(e,[...t,a])},set(c,a,s){y(n);const[l,u]=L(s);return p(e,{type:"SET",path:[...t,a].map(i=>i.toString()),value:l},u).then(g)},apply(c,a,s){y(n);const l=t[t.length-1];if(l===N)return p(e,{type:"ENDPOINT"}).then(g);if(l==="bind")return T(e,t.slice(0,-1));const[u,i]=D(s);return p(e,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:u},i).then(g)},construct(c,a){y(n);const[s,l]=D(a);return p(e,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:s},l).then(g)}});return Z(o,e),o}function te(e){return Array.prototype.concat.apply([],e)}function D(e){const t=e.map(L);return[t.map(r=>r[0]),te(t.map(r=>r[1]))]}const V=new WeakMap;function re(e,t){return V.set(e,t),e}function ne(e){return Object.assign(e,{[j]:!0})}function L(e){for(const[t,r]of M)if(r.canHandle(e)){const[n,o]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},o]}return[{type:"RAW",value:e},V.get(e)||[]]}function g(e){switch(e.type){case"HANDLER":return M.get(e.name).deserialize(e.value);case"RAW":return e.value}}function p(e,t,r){return new Promise(n=>{const o=se();e.addEventListener("message",function c(a){!a.data||!a.data.id||a.data.id!==o||(e.removeEventListener("message",c),n(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),r)})}function se(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const oe={open:E,read:P,create:W,update:G,destroy:F,readList:B,count:U};self.addEventListener("connect",e=>{const t=e.ports[0];C(oe,t)})})();
